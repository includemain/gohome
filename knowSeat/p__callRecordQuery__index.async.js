"use strict";(self.webpackChunksub_know_seat=self.webpackChunksub_know_seat||[]).push([[800],{61192:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var a=n(17662),l=n.n(a),i=n(31404),c=n.n(i),r=n(35118),o=n.n(r),s=n(17925),d=n.n(s),u=(n(63669),n(8186),n(23279),n(16769),n(48239),n(80348),n(25506),n(48493)),f=n(6889),m=n(62365),h=n(14748),v=n(81884),x=n(4843),p=n(89444),k=n(82405),_=n(978),g=n(73287),b=(n(97994),n(68900),n(29964),n(8532),n(99819)),j=n(94632),y=n.n(j),w="tagPopover___jhWfe",N=n(50107),Z="0Cpn",I=function(e){var t=e.str,n=void 0===t?"":t;return(0,N.jsx)("div",{className:"tag-item",_nk:"".concat(Z,"11"),children:(0,N.jsx)("span",{className:"text",_nk:"".concat(Z,"21"),children:n})})},R=function(e){var t=e.tags,n=void 0===t?[]:t,a=e.boxWidth,l=void 0===a?200:a,i=(0,_.useRef)(),c=(0,_.useState)(n),r=d()(c,2),o=r[0],s=r[1],u=(0,_.useState)([]),f=d()(u,2),m=f[0],h=f[1],x=(0,N.jsx)(v.Z,{size:[8,8],wrap:!0,style:{maxWidth:400},_nk:"".concat(Z,"31"),children:n.map((function(e){return(0,N.jsx)(I,{str:e,_nk:"iAr".concat(Z,"41")},e)}))});return(0,_.useLayoutEffect)((function(){var e;if(i.current){var t=(null===(e=i.current)||void 0===e?void 0:e.getElementsByClassName("tag-item"))||[],a=0,c=1;Array.from(t).forEach((function(e,t){if(!(c>2)){if(0===t)a=e.offsetWidth;else if(a+e.offsetWidth+8>l){var i=2===++c?24:0;a=e.offsetWidth+i}else a=a+e.offsetWidth+8;if(3===c){var r=y().cloneDeep(n),o=r.splice(t);s(r),h(o)}}}))}}),[n]),n.length?(0,N.jsx)("div",{className:w,ref:i,_nk:"".concat(Z,"12"),children:(0,N.jsx)(b.Z,{arrowPointAtCenter:!0,overlayClassName:"popover-container tag-busi-popover",placement:"bottomLeft",content:m.length?x:"",_nk:"".concat(Z,"51"),children:(0,N.jsxs)(v.Z,{size:[8,8],wrap:!0,_nk:"".concat(Z,"32"),children:[o.map((function(e){return(0,N.jsx)(I,{str:e,_nk:"iAr".concat(Z,"42")},e)})),!!m.length&&(0,N.jsx)("span",{className:"more-desc",_nk:"".concat(Z,"22"),children:"..."})]})})}):"-"},S=n(92938),C=n(57065),T=n.n(C),W="callRecordRoute___ZHc7g",P=n(46277),M=n(58703),Y=n(86013),D=n(17278),q=n(55375),A=(u.Z.RangePicker,"Nf4u"),E="_未评价_",H={"满意":"#52C41A","不满意":"#F5222D"},O=function(){var e,t,n,a,i,r,s=(0,_.useRef)(),b=(0,_.useState)([]),j=d()(b,2),w=j[0],Z=j[1],I=(0,_.useState)([]),C=d()(I,2),O=C[0],F=C[1],z=(0,_.useState)(!1),L=d()(z,2),B=L[0],V=L[1],G=(0,_.useState)(!1),K=d()(G,2),J=K[0],Q=K[1],U=(0,_.useRef)(),X=(0,S.useRequest)(P.O9,{manual:!0}),$=X.run,ee=X.loading,te=X.data,ne=(0,S.useRequest)(P.OZ,{}),ae=(ne.run,ne.data),le=(0,S.useRequest)(P.mL,{}),ie=(le.run,le.data),ce=(0,S.useRequest)((function(){return(0,Y._R)({types:[]})}),{onSuccess:function(e){var t;e&&(null==e||null===(t=e.callTypes)||void 0===t||t.push({id:"unknown",name:"未知"}),oe(o()({},e)))}}),re=ce.data,oe=ce.mutate,se=(0,S.useRequest)(Y.Ch,{manual:!0,onSuccess:function(e){Q(!0)}}),de=se.run,ue=se.data,fe=(0,S.useRequest)((function(){return(0,P.eR)()}),{}).data;(0,_.useEffect)((function(){(0,P.tY)().then((function(e){F(e.data||[])})),(0,P.B2)().then((function(e){Z(e.data||[])}))}),[]);var me=function(e){var t,n,a,l,i,c,r,s=null===(t=e.feedback)||void 0===t?void 0:t.filter((function(e){return e!==E})).concat(null==re||null===(n=re.feedbackTypes)||void 0===n?void 0:n.filter((function(e){return"未评价"===e.name})).map((function(e){return e.id}))),d=null!==(a=e.feedback)&&void 0!==a&&a.includes(E)?s:e.feedback;return o()(o()({},e),{},{seatId:e.seatName,callRecordType:e.type,feedback:d,category:e.category||[],order:"ascend"===e.acceptTime?"asc":"desc",startTime:null!==(l=e.timeRange)&&void 0!==l&&l[0]?null===(i=e.timeRange)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.format("YYYY-MM-DD"):void 0,endTime:null!==(c=e.timeRange)&&void 0!==c&&c[1]?null===(r=e.timeRange)||void 0===r||null===(r=r[1])||void 0===r?void 0:r.format("YYYY-MM-DD"):void 0})},he={columns:[{width:100,dataIndex:"seatName",title:"坐席姓名",filterMultiple:!0,filterSearch:function(e,t){var n;return e?null==O||null===(n=O.filter((function(t){var n,a;return(null===(n=t.seatName)||void 0===n?void 0:n.includes(e))||(null===(a=t.seatId)||void 0===a?void 0:a.includes(e))})))||void 0===n?void 0:n.map((function(e){return{label:e.seatName,text:e.seatName,value:e.seatId,nickName:e.seatId}})):[]},filters:[]},{width:110,dataIndex:"acceptTime",title:"联络时间",sorter:!0},{width:110,dataIndex:"callNumber",title:"主叫号码"},{width:100,dataIndex:"type",title:"通话类型",filterMultiple:!0,filters:(null==re||null===(e=re.callTypes)||void 0===e?void 0:e.map((function(e){return{value:e.id,label:e.name,text:e.name}})))||[]},{width:400,dataIndex:"problem",title:"问题描述",render:function(e,t){return(0,N.jsx)(D.Z,{record:t,_nk:"".concat(A,"11")})}},{dataIndex:"emotionTag",title:"情绪标签",filters:(null==ie||null===(t=ie.map)||void 0===t?void 0:t.call(ie,(function(e){return{label:e,text:e,value:e}})))||[],render:function(e){return(0,N.jsx)("span",{style:{color:H[e]||"#975FE4"},_nk:"".concat(A,"21"),children:e})}},{width:200,dataIndex:"businessTag",title:"业务标签",filterSearch:!0,filters:(null==ae||null===(n=ae.map)||void 0===n?void 0:n.call(ae,(function(e){return{label:e,text:e,value:e}})))||[],render:function(e){return(0,N.jsx)(R,{tags:(null==e?void 0:e.split("、"))||[],boxWidth:184,_nk:"".concat(A,"31")})}},{width:100,dataIndex:"solution",title:"解决办法",filterMultiple:!0,filters:null==w?void 0:w.map((function(e){return{label:e.solution,text:e.solution,value:e.solution}}))},{width:100,dataIndex:"customerName",title:"客户名称"},{width:100,dataIndex:"feedback",title:"客户反馈",filterMultiple:!0,filters:(null==re||null===(a=re.feedbackTypes)||void 0===a?void 0:a.filter((function(e){return"未评价"!==e.name})).map((function(e){return{value:e.id,label:e.name,text:e.name}})).concat([{value:E,label:"未评价",text:"未评价"}]))||[]},{dataIndex:"option",width:77,title:"操作",fixed:"right",render:function(e,t){return(0,N.jsx)("div",{className:"table-btns",_nk:"".concat(A,"41"),children:(0,N.jsx)(f.Z,{type:"link",onClick:function(){de({source:t.source,callId:t.callId})},_nk:"".concat(A,"51"),children:" 详情"})})}}],loading:ee,total:(null==te?void 0:te.count)||0,dataSource:(null==te?void 0:te.list)||[],getData:function(e){var t=me(e);return $(t)},rowKey:"callId",formChildren:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(m.Z.Item,{label:"客户账号：",name:"fundAccountId",_nk:"".concat(A,"61"),children:(0,N.jsx)(h.Z,{placeholder:"请输入",style:{minWidth:160,width:160},_nk:"".concat(A,"71")})}),(0,N.jsx)(m.Z.Item,{label:"客户名称：",name:"customerName",_nk:"".concat(A,"62"),children:(0,N.jsx)(h.Z,{placeholder:"请输入",style:{minWidth:160,width:160},_nk:"".concat(A,"72")})}),(0,N.jsx)(m.Z.Item,{label:"时间区间：",initialValue:[T()().startOf("day"),T()().endOf("day")],name:"timeRange",_nk:"".concat(A,"63"),children:(0,N.jsx)(u.Z.RangePicker,{style:{minWidth:230,width:230},placeholder:["开始日期","结束日期"],allowClear:!1,_nk:"".concat(A,"64")})}),(0,N.jsxs)(v.Z,{wrap:!1,_nk:"".concat(A,"81"),children:[(0,N.jsx)(m.Z.Item,{label:"通话分类",name:"category",_nk:"".concat(A,"65"),children:(0,N.jsx)(x.Z,{treeData:fe||[],fieldNames:{label:"name",value:"id",children:"children"},treeCheckable:!0,treeNodeFilterProp:"name",showCheckedStrategy:x.Z.SHOW_PARENT,placeholder:"请选择",showSearch:!0,allowClear:!0,maxTagCount:"responsive",style:{width:220},_nk:"".concat(A,"91")})}),(0,N.jsx)(m.Z.Item,{label:"",noStyle:!0,name:"logic",style:{lineHeight:"32px"},initialValue:"or",_nk:"".concat(A,"66"),children:(0,N.jsxs)(p.ZP.Group,{_nk:"".concat(A,"67"),children:[(0,N.jsx)(p.ZP,{value:"or",_nk:"".concat(A,"a1"),children:"或"}),(0,N.jsx)(p.ZP,{value:"and",_nk:"".concat(A,"a2"),children:"与"})]})})]})]}),extra:(0,N.jsx)(f.Z,{type:"primary",className:"extra-btn",onClick:c()(l()().mark((function e(){var t,n,a,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=s.current)||void 0===t?void 0:t.getTableParams();case 2:return n=e.sent,a=y().omit(n,"page","pageSize"),V(!0),i=me(a),e.next=8,(0,P.ed)(i).catch((function(e){return V(!1)}));case 8:V(!1),k.ZP.success("导出成功");case 10:case"end":return e.stop()}}),e)}))),loading:B,_nk:"".concat(A,"52"),children:B?"导出中":"导出"})},ve=void 0===q.o.yx?"calc(100vh - 110px)":"100vh",xe=(null===(i=U.current)||void 0===i?void 0:i.offsetHeight)||360,pe=null===(r=U.current)||void 0===r?void 0:r.querySelector(".table-header-box"),ke=null!=pe&&pe.offsetHeight?(null==pe?void 0:pe.offsetHeight)+68:0;return(0,N.jsx)("div",{className:W,style:{height:ve},_nk:"".concat(A,"42"),children:(0,N.jsxs)("div",{className:"main-box",_nk:"".concat(A,"43"),children:[(0,N.jsx)("div",{className:"box-title",_nk:"".concat(A,"44"),children:"通话记录查询"}),(0,N.jsx)("div",{className:"main-content",_nk:"".concat(A,"45"),children:(0,N.jsx)("div",{className:"flex-list",ref:U,_nk:"".concat(A,"46"),children:(0,N.jsx)(g.Z,o()(o()({ref:s},he),{},{paginationMap:{current:"page"},scroll:{x:1500,y:xe-ke-68},_nk:"".concat(A,"b1")}))})}),(0,N.jsx)(M.Z,{showTelrec:J,setShowTelrec:Q,telRecords:ue,_nk:"".concat(A,"c1")})]})})}}}]);
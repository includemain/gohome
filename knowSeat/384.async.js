(self.webpackChunksub_know_seat=self.webpackChunksub_know_seat||[]).push([[384],{3518:function(e,n,t){"use strict";t.d(n,{Ih:function(){return x},uU:function(){return p}});var s=t(35118),i=t.n(s),o=t(153),r=t.n(o),u=(t(68046),t(71219),t(76551),t(79062),t(23279),t(16769),t(80348),t(25506),t(14748)),a=t(89444),l=t(41114),c=t(37244),d=t(28068),v=t(62365),m=(t(978),t(50107)),h="Ybj1",p={fill:"填空",single:"单选",multiple:"多选"},f={fill:function(e){var n,t=e.value,s=e.onChange,i=e.questionItem;return(0,m.jsx)(u.Z.TextArea,{placeholder:"请输入",onChange:function(e){s({questionId:i.questionId,type:i.type,questionAnswer:{text:e.target.value}})},value:(null==t||null===(n=t.questionAnswer)||void 0===n?void 0:n.text)||"",style:{height:62,marginLeft:8,resize:"none"},_nk:"".concat(h,"11")})},single:function(e){var n,t,s,i,o,r,d=e.value,v=e.onChange,p=e.questionItem,f={questionId:null!==(n=null==d?void 0:d.questionId)&&void 0!==n?n:p.questionId,type:null!==(t=null==d?void 0:d.type)&&void 0!==t?t:p.type,questionAnswer:{optionAnswers:(null==d||null===(s=d.questionAnswer)||void 0===s?void 0:s.optionAnswers)||[]}},x=function(e,n){f.questionAnswer.optionAnswers=[{index:e||"",filling:n||""}],v(f)},b=(null==d||null===(i=d.questionAnswer)||void 0===i?void 0:i.optionAnswers)||[],k=(null===(o=b[0])||void 0===o?void 0:o.index)+""||"";return(0,m.jsx)(a.ZP.Group,{style:{width:"100%"},value:k,_nk:"".concat(h,"12"),children:(0,m.jsx)(l.Z,{_nk:"".concat(h,"21"),children:null===(r=p.options)||void 0===r?void 0:r.map((function(e,n){var t,s;return(0,m.jsxs)(c.Z,{flex:(null===(t=e.description)||void 0===t?void 0:t.length)>22?"0 1 100%":"0 1 50%",className:"option-column",_nk:"".concat(h,"31"),children:[(0,m.jsx)(a.ZP,{value:n+1+"",onChange:function(e){return x(n+1+"","")},_nk:"".concat(h,"41"),children:e.description}),e.enableFilling&&(0,m.jsx)(u.Z,{maxLength:500,disabled:k!==n+1+"",onChange:function(e){return x(n+1+"",e.target.value)},value:k===n+1+""?null===(s=b[0])||void 0===s?void 0:s.filling:"",className:"option-input",placeholder:"请输入",_nk:"".concat(h,"51")})]},n)}))})})},multiple:function(e){var n,t,s,i,o,a=e.value,v=e.onChange,p=e.questionItem,f=p.maxSelectedOptionCount,x={questionId:null!==(n=null==a?void 0:a.questionId)&&void 0!==n?n:p.questionId,type:null!==(t=null==a?void 0:a.type)&&void 0!==t?t:p.type,questionAnswer:{optionAnswers:(null==a||null===(s=a.questionAnswer)||void 0===s?void 0:s.optionAnswers)||[]}},b=function(e){!0===e.target.checked?x.questionAnswer.optionAnswers.push({index:e.target.value||"",filling:""}):r()(x.questionAnswer.optionAnswers,(function(n){return n.index==e.target.value})),v(x)},k=function(e,n){var t=x.questionAnswer.optionAnswers.find((function(n){return n.index==e}));t&&(t.filling=n),v(x)},w=(null==a||null===(i=a.questionAnswer)||void 0===i?void 0:i.optionAnswers)||[],y=w.map((function(e){return e.index+""}))||[];return(0,m.jsx)(d.Z.Group,{style:{width:"100%"},value:y,_nk:"".concat(h,"13"),children:(0,m.jsx)(l.Z,{_nk:"".concat(h,"22"),children:null===(o=p.options)||void 0===o?void 0:o.map((function(e,n){var t,s;return(0,m.jsxs)(c.Z,{flex:(null===(t=e.description)||void 0===t?void 0:t.length)>22?"0 1 100%":"0 1 50%",className:"option-column",_nk:"".concat(h,"32"),children:[(0,m.jsx)(d.Z,{value:n+1+"",disabled:y.length>=f&&!y.includes(n+1+""),onChange:b,_nk:"".concat(h,"61"),children:e.description}),e.enableFilling&&(0,m.jsx)(u.Z,{maxLength:500,disabled:!w.find((function(e){return e.index==n+1+""})),onChange:function(e){return k(n+1+"",e.target.value)},value:(null===(s=w.find((function(e){return e.index==n+1+""})))||void 0===s?void 0:s.filling)||"",className:"option-input",placeholder:"请输入",_nk:"".concat(h,"52")})]},n)}))})})}},x=function(e){var n,t,s=f[null===(n=e.questionItem)||void 0===n?void 0:n.type];return s?(0,m.jsx)(v.Z.Item,{style:{width:800},name:["answers",e.nameUnique],rules:[{required:(null===(t=e.questionItem)||void 0===t?void 0:t.required)||!1,message:"请输入"}],_nk:"".concat(h,"14"),children:(0,m.jsx)(s,i()(i()({},e),{},{_nk:"".concat(h,"81")}))}):(0,m.jsx)("h1",{_nk:"".concat(h,"71"),children:"没找到"})}},84384:function(e,n,t){"use strict";t.d(n,{Z:function(){return N}});var s=t(17662),i=t.n(s),o=t(35118),r=t.n(o),u=t(31404),a=t.n(u),l=t(17925),c=t.n(l),d=(t(16769),t(80348),t(29471),t(8532),t(48493)),v=t(14748),m=t(28068),h=t(62365),p=t(82405),f=t(22944),x=t(41114),b=t(37244),k=t(6889),w=t(978),y=t(1164),g=t(57065),_=t.n(g),q="fillQuestionForm___lICdv",Z=t(84871),j=t(60030),I=t(3518),A=t(50107),C=(d.Z.RangePicker,v.Z.TextArea,m.Z.Group,"5zsV"),N=function(e){var n=h.Z.useForm(),t=(c()(n,1)[0],h.Z.useForm()),s=c()(t,1)[0],o=e.previewReleaseOpen,u=e.handleCancel,l=e.rowRecords,m=e.customerInfo,g=(e.previewIndex,e.refresh),N=e.type,S=(0,w.useState)(""),T=c()(S,2),R=(T[0],T[1],(0,w.useState)([!0])),P=c()(R,2),F=(P[0],P[1],(0,w.useState)([""])),L=c()(F,2),Y=(L[0],L[1],(0,w.useState)([])),O=c()(Y,2),V=O[0],E=O[1],M=(0,w.useState)({}),D=c()(M,2),G=D[0],U=D[1],z=(0,w.useState)(),Q=c()(z,2),H=(Q[0],Q[1],(0,w.useState)()),X=c()(H,2),$=(X[0],X[1],(0,w.useState)()),B=c()($,2),J=(B[0],B[1],(0,w.useState)([])),K=c()(J,2),W=(K[0],K[1],(0,w.useState)([])),ee=c()(W,2),ne=(ee[0],ee[1]),te=(0,w.useState)(""),se=c()(te,2),ie=se[0],oe=se[1],re=(0,w.useContext)(j.CustomContext),ue=re.userInfo,ae=(re.fundAccId,re.seatName,re.seatId,ue.customerId),le=void 0===ae?"":ae;(0,w.useEffect)((function(){oe((new Date).getTime()),o&&("view"==N?E(null==l?void 0:l.questionViews):(U(m),(0,y.e8)({userSheetId:null==m?void 0:m.userSheetId}).then((function(e){var n,t={};null==e||null===(n=e.data)||void 0===n||n.forEach((function(n,s){var i;t[s]=null==e||null===(i=e.data)||void 0===i?void 0:i[s]})),s.setFieldsValue({answers:t}),E(null==e?void 0:e.data)})).catch((function(){p.ZP.error("服务异常")}))))}),[o]);var ce=function(){var e=a()(i()().mark((function e(){var n,t,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("view"!=N){e.next=5;break}n={surveyId:null==l?void 0:l.surveyId,status:2},(0,y.i2)(r()({},n)).then((function(e){"0000"==(null==e?void 0:e.code)&&(p.ZP.success("发布成功"),g(!0),u(!1))})).catch((function(){p.ZP.error("服务异常")})),e.next=14;break;case 5:if("edit"!=N){e.next=14;break}return e.next=8,s.validateFields();case 8:return t=e.sent,o=r()(r()({},t),{},{answers:Object.values((null==t?void 0:t.answers)||{}),customerId:le,surveyId:null==m?void 0:m.surveyId,startTime:ie,userSheetId:null==m?void 0:m.userSheetId}),e.next=12,(0,y.Ps)(o);case 12:"0000"===e.sent.code&&(p.ZP.success("保存成功"),g(!0),u(!1));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,A.jsx)("div",{className:"question-detail",_nk:"".concat(C,"11"),children:(0,A.jsxs)(f.Z,{title:"view"==N?"问卷调查":"编辑调查问卷",open:o,destroyOnClose:!0,onCancel:function(){u(!1)},width:860,className:"modal-table-detail question-detail-modal",footer:null,height:768,okText:"发布",cancelText:"关闭",_nk:"".concat(C,"21"),children:[(0,A.jsx)("div",{className:"modal-table-detail-body",_nk:"".concat(C,"12"),children:(0,A.jsxs)(h.Z,{form:s,className:q,initialValues:{customerName:(null==G?void 0:G.customerName)||"-",customerAge:(null==G?void 0:G.age)||"-",seatName:(null==G?void 0:G.operator)||"-",fundAccountId:(null==G?void 0:G.fundAccountId)||"-",customerMobile:(null==G?void 0:G.mobile)||"-",submitTime:null!=G&&G.createTime?_()((0,Z.rr)(null==G?void 0:G.createTime),"YYYY-MM-DD"):""},name:"dynamic_rule",_nk:"".concat(C,"31"),children:[(0,A.jsxs)(x.Z,{_nk:"".concat(C,"41"),children:[(0,A.jsxs)(b.Z,{span:12,_nk:"".concat(C,"51"),children:[(0,A.jsx)(h.Z.Item,{label:"客户姓名",name:"customerName",_nk:"".concat(C,"61"),children:(0,A.jsx)(v.Z,{placeholder:"请输入",style:{width:280,borderRadius:8},disabled:!0,_nk:"".concat(C,"71")})}),(0,A.jsx)(h.Z.Item,{label:"客户年龄：",name:"customerAge",_nk:"".concat(C,"62"),children:(0,A.jsx)(v.Z,{placeholder:"请输入",style:{width:280,borderRadius:8},disabled:!0,_nk:"".concat(C,"72")})}),(0,A.jsx)(h.Z.Item,{label:"记录人：",name:"seatName",labelCol:{flex:"0 0 68px"},_nk:"".concat(C,"63"),children:(0,A.jsx)(v.Z,{style:{width:280,borderRadius:8},disabled:!0,placeholder:"请输入",_nk:"".concat(C,"73")})})]}),(0,A.jsxs)(b.Z,{span:12,_nk:"".concat(C,"52"),children:[(0,A.jsx)(h.Z.Item,{label:"客户账号：",name:"fundAccountId",_nk:"".concat(C,"64"),children:(0,A.jsx)(v.Z,{style:{width:280,borderRadius:8},disabled:!0,placeholder:"请输入",_nk:"".concat(C,"74")})}),(0,A.jsx)(h.Z.Item,{label:"客户电话",name:"customerMobile",_nk:"".concat(C,"65"),children:(0,A.jsx)(v.Z,{style:{width:280,borderRadius:8},disabled:!0,placeholder:"请输入",_nk:"".concat(C,"75")})}),(0,A.jsx)(h.Z.Item,{label:"回答时间",name:"submitTime",_nk:"".concat(C,"66"),children:(0,A.jsx)(d.Z,{style:{width:280,borderRadius:8},disabled:!0,showTime:!0,_nk:"".concat(C,"81")})})]})]}),(0,A.jsxs)(x.Z,{className:"que-title",_nk:"".concat(C,"42"),children:["view"==N?null==l?void 0:l.surveyName:null==m?void 0:m.surveyName,"："]}),(0,A.jsx)(h.Z.Item,{noStyle:!0,name:"answers",_nk:"".concat(C,"67"),children:null==V?void 0:V.map((function(e,n){return(0,A.jsxs)(x.Z,{style:{width:750},_nk:"".concat(C,"43"),children:[(0,A.jsxs)(x.Z,{className:"vertical-label",_nk:"".concat(C,"44"),children:[n+1,".",e.content]}),(0,A.jsx)(I.Ih,{questionItem:e,setQueAnswer:ne,nameUnique:n+"",_nk:"".concat(C,"91")})]},e.questionId)}))})]})}),(0,A.jsxs)(x.Z,{justify:"end",style:{paddingRight:24},_nk:"".concat(C,"45"),children:[(0,A.jsx)(k.Z,{className:"ghost-btn",onClick:function(){u(!1)},style:{marginLeft:8},_nk:"".concat(C,"a1"),children:"关闭"}),(0,A.jsx)(k.Z,{type:"primary",className:"submit-btn",onClick:ce,style:{marginLeft:8},_nk:"".concat(C,"a2"),children:"view"==N?"发布":"保存"})]})]})})}},1164:function(e,n,t){"use strict";t.d(n,{Ps:function(){return g},TP:function(){return w},Vx:function(){return b},e8:function(){return y},i2:function(){return x},m$:function(){return k},nX:function(){return f},tY:function(){return v},uE:function(){return m},uf:function(){return d},x3:function(){return p}});var s=t(17662),i=t.n(s),o=t(31404),r=t.n(o),u=t(35118),a=t.n(u),l=t(92938),c=t(40396);function d(e){return(0,l.request)("/rest/csibs/survey/list",{method:"post",data:a()(a()({},e),{},{page:(null==e?void 0:e.page)-1})})}function v(){return(0,l.request)("/rest/csibs/survey/operator-list",{method:"post"})}function m(e){return h.apply(this,arguments)}function h(){return(h=r()(i()().mark((function e(n){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.request)("/rest/csibs/survey/export",{method:"POST",headers:{"Content-Type":"application/json"},responseType:"blob",data:n,getResponse:!0,timeout:6e4,skipErrorHandler:!0});case 2:return t=e.sent,e.abrupt("return",(0,c.LR)(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return(0,l.request)("/rest/csibs/survey/statistics",{method:"post",data:e})}function f(e){return(0,l.request)("/rest/csibs/survey/create",{method:"post",data:a()({},e)})}function x(e){return(0,l.request)("/rest/csibs/survey/update-status",{method:"post",data:a()({},e)})}function b(e){return(0,l.request)("/rest/csibs/survey/update",{method:"post",data:a()({},e)})}function k(e){return(0,l.request)("/rest/csibs/survey/submit-record/list",{method:"post",data:a()(a()({},e),{},{page:(null==e?void 0:e.page)-1})})}function w(){return(0,l.request)("/rest/csibs/survey/submit-record/customer-name",{method:"post"})}function y(e){return(0,l.request)("/rest/csibs/survey/submit-record/detail",{method:"post",data:a()({},e)})}function g(e){return(0,l.request)("/rest/csibs/survey/submit",{method:"post",data:a()({},e)})}},153:function(e,n,t){var s=t(91735),i=t(20741);e.exports=function(e,n){var t=[];if(!e||!e.length)return t;var o=-1,r=[],u=e.length;for(n=s(n,3);++o<u;){var a=e[o];n(a,o,e)&&(t.push(a),r.push(o))}return i(e,r),t}}}]);